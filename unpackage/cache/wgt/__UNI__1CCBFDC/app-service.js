if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((a=>t.resolve(e()).then((()=>a))),(a=>t.resolve(e()).then((()=>{throw a}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";function t(e,t,...a){uni.__log__?uni.__log__(e,t,...a):console[e].apply(console,[...a,t])}function a({url:e,method:a="GET",data:o={},header:n={}}){return new Promise(((s,i)=>{const c=uni.getSystemInfoSync(),r=String(c.deviceId);t("log","at utils/request.js:13","设备信息：",c),t("log","at utils/request.js:14","设备ID:",c.deviceId);const l={DEVICE_ID:r,"Content-Type":"application/json"};if("GET"===a.toUpperCase()&&Object.keys(o).length){const t=Object.keys(o).map((e=>`${encodeURIComponent(e)}=${encodeURIComponent(o[e])}`)).join("&");e=`${e}?${t}`}t("log","at utils/request.js:27","head:"+n),uni.request({url:e,method:a,data:"GET"===a.toUpperCase()?null:o,header:{...l,...n},success:e=>{200===e.statusCode?s(e.data):(uni.showToast({title:e.data.message||"请求失败",icon:"none"}),i(e))},fail:e=>{uni.showToast({title:"网络请求失败",icon:"none"}),i(e)}})}))}let o="",n="",s=null,i=null,c=null,r=!1,l=null,d=!1,u=new Date,m=(e,a)=>{o=e,t("log","at common/websocket.js:63","wsurl====>>>>>",o),n=a,r||(u=new Date,uni.connectSocket({url:o,success:e=>{t("log","at common/websocket.js:71","websocket连接成功")},fail:e=>{t("log","at common/websocket.js:73",e),t("log","at common/websocket.js:74","websocket连接失败，10s后重连"),setTimeout((()=>{m()}),1e4)}}))};var g={timeout:1e4,timeoutObj:null,start:function(){if(r){t("log","at common/websocket.js:120","发送WebSocket心跳");let e={type:3,data:{}};uni.sendSocketMessage({data:JSON.stringify(e),fail(e){t("log","at common/websocket.js:126",e)}})}},reset:function(){clearTimeout(this.timeoutObj),this.timeoutObj=setTimeout((function(){g.start()}),this.timeout)}};const p=(e,t)=>{const a=e.__vccOpts||e;for(const[o,n]of t)a[o]=n;return a};const h=p({data:()=>({userName:"",emailError:!1,passwordError:!1,password:"",captcha:"1",remember:!1,redirectUrl:"http://jvks.si/ucut"}),mounted(){},methods:{validateEmail:e=>/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e),validatePassword:e=>e.length>=6,sendVerificationCode(){if(""!==this.userName)return this.validateEmail(this.userName)?(t("log","at pages/login/login.vue:85",this.validateEmail(this.userName)),void uni.showToast({title:"邮箱格式不正确",icon:"none"})):void uni.showToast({title:"验证码已发送",icon:"success"});uni.showToast({title:"请输入邮箱地址",icon:"none"})},async login(){if(""===this.userName||""===this.verificationCode)return void uni.showToast({title:"请填写完整信息",icon:"none"});if(!this.validateEmail(this.userName))return t("log","at pages/login/login.vue:120",this.validateEmail(this.userName)),void uni.showToast({title:"邮箱格式不正确",icon:"none"});const e={userName:this.userName,password:this.password,remember:this.remember,captcha:this.captcha,redirectUrl:this.redirectUrl};try{const o=await a({url:"/api/authenticate/login",method:"POST",data:e});if(t("log","at pages/login/login.vue:146","响应结果：",o),"0"===o.code){const e=o.data.token;localStorage.setItem("login-token",e),t("log","at pages/login/login.vue:151","登录成功，Token:",e),uni.showToast({title:"登录成功",icon:"success"}),uni.setStorageSync("loginUser",o.data.loginUser),uni.setStorageSync("token",o.data.token),t("log","at pages/login/login.vue:160","用户信息已存储"),setTimeout((()=>{uni.navigateTo({url:"/pages/conversation/conversation"})}),1e3)}else uni.showToast({title:o.message,icon:"none"})}catch(o){t("error","at pages/login/login.vue:174","登录请求错误:",o),uni.showToast({title:"登录失败，请重试"+o,icon:"none"})}}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"container"},[e.createElementVNode("div",{class:"title"},"欢迎登录"),e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon"},[e.createElementVNode("i",{class:"iconfont"},"")]),e.withDirectives(e.createElementVNode("input",{class:"input",type:"email",placeholder:"用户名/邮箱","onUpdate:modelValue":a[0]||(a[0]=e=>s.userName=e),onBlur:a[1]||(a[1]=(...e)=>i.validateEmail&&i.validateEmail(...e))},null,544),[[e.vModelText,s.userName]]),s.emailError?(e.openBlock(),e.createElementBlock("div",{key:0,class:"error"},"邮箱地址格式不正确")):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon"},[e.createElementVNode("i",{class:"iconfont"},"")]),e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:"密码","onUpdate:modelValue":a[2]||(a[2]=e=>s.password=e),onBlur:a[3]||(a[3]=(...e)=>i.validatePassword&&i.validatePassword(...e))},null,544),[[e.vModelText,s.password]]),s.passwordError?(e.openBlock(),e.createElementBlock("div",{key:0,class:"error"},"密码格式不正确")):e.createCommentVNode("",!0)]),e.createElementVNode("button",{class:"login-btn",onClick:a[4]||(a[4]=(...e)=>i.login&&i.login(...e))},"登录"),e.createElementVNode("div",{class:"register-link"},[e.createElementVNode("navigator",{url:"/pages/register/register"}," 没有账号，前往注册 ")])])}]]),v=/^[A-Za-z0-9_]+$/,y=/^[^\s@]+@[^\s@]+\.[^\s@]+$/,f=/^(?=.*[A-Za-z])(?=.*\d)[A-Za-z\d]{8,}$/;function N(e){return y.test(e)}function E(e){return f.test(e)}const k={BASE_URL:"http://115.159.23.172:80",WS_URL:"ws://115.159.23.172:80/websocket"};const V=p({data:()=>({userName:"",email:"",password:"",confirmPassword:"",captcha:"",captchaImage:"",emailError:!1,passwordMismatch:!1}),mounted(){this.refreshCaptcha()},methods:{validateEmail(){this.emailError=!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(this.email)},async refreshCaptcha(){this.captchaImage=k.BASE_URL+`/validate-code?t=${Date.now()}`},async register(){if(!this.userName)return uni.showToast({title:"请输入用户名",icon:"none"});if(!this.email)return uni.showToast({title:"请输入邮箱",icon:"none"});if(!this.password)return uni.showToast({title:"请输入密码",icon:"none"});if(!this.confirmPassword)return uni.showToast({title:"请输入确认密码",icon:"none"});if(!this.captcha)return uni.showToast({title:"请输入验证码",icon:"none"});var e;e=this.userName,v.test(e),N(this.email),E(this.password),E(this.confirmPassword),this.passwordMismatch=this.password!==this.confirmPassword;try{const e={userName:this.userName,email:this.email,password:this.password,confirmPassword:this.confirmPassword,channel:null,captcha:this.captcha},o=await a({url:"/api/authenticate/email-register",method:"POST",data:e});t("log","at pages/register/register.vue:139","响应结果：",o),"0"===o.code?(uni.showToast({title:"注册成功",icon:"success"}),uni.navigateTo({url:"/pages/login/login"})):uni.showToast({title:o.message||"注册失败",icon:"none"})}catch(o){t("error","at pages/register/register.vue:155","注册请求错误:",o),uni.showToast({title:"注册失败，请重试",icon:"none"})}}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"container"},[e.createElementVNode("div",{class:"title"},"欢迎注册"),e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon"},[e.createElementVNode("i",{class:"iconfont"},"")]),e.withDirectives(e.createElementVNode("input",{class:"input",type:"text",placeholder:"用户名","onUpdate:modelValue":a[0]||(a[0]=e=>s.userName=e)},null,512),[[e.vModelText,s.userName]])]),e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon"},[e.createElementVNode("i",{class:"iconfont"},"")]),e.withDirectives(e.createElementVNode("input",{class:"input",type:"email",placeholder:"邮箱","onUpdate:modelValue":a[1]||(a[1]=e=>s.email=e),onBlur:a[2]||(a[2]=(...e)=>i.validateEmail&&i.validateEmail(...e))},null,544),[[e.vModelText,s.email]]),s.emailError?(e.openBlock(),e.createElementBlock("div",{key:0,class:"error"},"邮箱地址格式不正确")):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon"},[e.createElementVNode("i",{class:"iconfont"},"")]),e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:"密码","onUpdate:modelValue":a[3]||(a[3]=e=>s.password=e)},null,512),[[e.vModelText,s.password]])]),e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon"},[e.createElementVNode("i",{class:"iconfont"},"")]),e.withDirectives(e.createElementVNode("input",{class:"input",type:"password",placeholder:"确认密码","onUpdate:modelValue":a[4]||(a[4]=e=>s.confirmPassword=e)},null,512),[[e.vModelText,s.confirmPassword]]),s.passwordMismatch?(e.openBlock(),e.createElementBlock("div",{key:0,class:"error"},"两次输入的密码不一致")):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"input-group"},[e.withDirectives(e.createElementVNode("input",{class:"input code-input",type:"text",placeholder:"请输入验证码","onUpdate:modelValue":a[5]||(a[5]=e=>s.captcha=e)},null,512),[[e.vModelText,s.captcha]]),e.createElementVNode("img",{src:s.captchaImage,alt:"验证码",class:"captcha-image",onClick:a[6]||(a[6]=(...e)=>i.refreshCaptcha&&i.refreshCaptcha(...e))},null,8,["src"])]),e.createElementVNode("button",{class:"login-btn",onClick:a[7]||(a[7]=(...e)=>i.register&&i.register(...e))},"注册"),e.createElementVNode("div",{class:"login-link"},[e.createElementVNode("navigator",{url:"/pages/login/login"}," 已有账号，前往登录 ")])])}]]);const w=p({data:()=>({body:{userName:"",email:"",password:"",confirmPassword:"",captcha:"",channel:"web",agree:!1}}),methods:{async register(){if(!(this.body.userName&&this.body.email&&this.body.password&&this.body.confirmPassword))return uni.showToast({title:"请填写完整信息",icon:"none"});if(N(this.body.userName),E(this.body.password),E(this.body.confirmPassword),this.body.password!==this.body.confirmPassword)return uni.showToast({title:"两次密码输入不一致",icon:"none"});if(!this.body.agree)return uni.showToast({title:"请先同意用户协议和隐私政策",icon:"none"});t("log","at pages/register/register-1.vue:138","请求体数据：",this.body);try{const e=await a({url:"/api/authenticate/email-register",method:"POST",data:this.body});t("log","at pages/register/register-1.vue:148","响应结果：",e),"0"===e.code?(uni.showToast({title:"注册成功",icon:"success"}),uni.navigateTo({url:"/pages/login/login"})):uni.showToast({title:e.data.message||"注册失败",icon:"none"})}catch(e){t("error","at pages/register/register-1.vue:165","注册失败:",e),uni.showToast({title:"注册失败",icon:"none"})}},async getCaptcha(){},goToLogin(){uni.navigateTo({url:"/pages/login/login"})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"container"},[e.createElementVNode("div",{class:"header"},"欢迎注册"),e.createElementVNode("div",{class:"form-item"},[e.withDirectives(e.createElementVNode("input",{type:"text",placeholder:"用户名","onUpdate:modelValue":a[0]||(a[0]=e=>s.body.userName=e),class:"input"},null,512),[[e.vModelText,s.body.userName]])]),e.createElementVNode("div",{class:"form-item"},[e.withDirectives(e.createElementVNode("input",{type:"email",placeholder:"邮箱","onUpdate:modelValue":a[1]||(a[1]=e=>s.body.email=e),class:"input"},null,512),[[e.vModelText,s.body.email]])]),e.createElementVNode("div",{class:"form-item"},[e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"密码","onUpdate:modelValue":a[2]||(a[2]=e=>s.body.password=e),class:"input"},null,512),[[e.vModelText,s.body.password]])]),e.createElementVNode("div",{class:"form-item"},[e.withDirectives(e.createElementVNode("input",{type:"password",placeholder:"确认密码","onUpdate:modelValue":a[3]||(a[3]=e=>s.body.confirmPassword=e),class:"input"},null,512),[[e.vModelText,s.body.confirmPassword]])]),e.createElementVNode("div",{class:"form-item"},[e.withDirectives(e.createElementVNode("input",{type:"checkbox",id:"agreement","onUpdate:modelValue":a[4]||(a[4]=e=>s.body.agree=e),class:"checkbox"},null,512),[[e.vModelCheckbox,s.body.agree]]),e.createElementVNode("label",{for:"agreement",class:"agreement-text"},[e.createTextVNode(" 我已阅读并同意 "),e.createElementVNode("a",{href:"/pages/agreement/user",class:"link"},"《用户协议》"),e.createTextVNode(" 和 "),e.createElementVNode("a",{href:"/pages/agreement/privacy",class:"link"},"《隐私政策》")])]),e.createElementVNode("div",{class:"form-item"},[e.createElementVNode("button",{class:"btn",onClick:a[5]||(a[5]=(...e)=>i.register&&i.register(...e))},"注册并登录")]),e.createElementVNode("div",{class:"back-to-login",onClick:a[6]||(a[6]=(...e)=>i.goToLogin&&i.goToLogin(...e))}," 返回登录页面 ")])}]]);const b=p({data:()=>({username:"",password:"",showPassword:!1}),methods:{updateUsername(e){this.username=e.target.innerText},clearUsername(){this.username="",this.$nextTick((()=>{document.querySelector('.input[placeholder="用户名"]').innerText=""}))},updatePassword(e){this.password=e.target.innerText},togglePassword(){this.showPassword=!this.showPassword;const e=document.querySelector('.input[placeholder="密码"]');this.showPassword?e.style.webkitTextSecurity="none":e.style.webkitTextSecurity="disc"},login(){this.username&&this.password?(uni.showToast({title:"登录成功",icon:"success"}),setTimeout((()=>{uni.switchTab({url:"/pages/home/home"})}),1e3)):uni.showToast({title:"请输入用户名和密码",icon:"none"})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("view",{class:"login-container"},[e.createElementVNode("div",{class:"welcome-text"},[e.createElementVNode("text",null,"欢迎登录")]),e.createElementVNode("div",{class:"form"},[e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon user-icon"}),e.createElementVNode("div",{class:"input-wrapper"},[e.createElementVNode("div",{class:"input",contenteditable:"true",onInput:a[0]||(a[0]=(...e)=>i.updateUsername&&i.updateUsername(...e)),placeholder:"用户名"},null,32)]),s.username?(e.openBlock(),e.createElementBlock("div",{key:0,class:"clear-icon",onClick:a[1]||(a[1]=(...e)=>i.clearUsername&&i.clearUsername(...e))},"✖ ")):e.createCommentVNode("",!0)]),e.createElementVNode("div",{class:"input-group"},[e.createElementVNode("div",{class:"icon lock-icon"}),e.createElementVNode("div",{class:"input-wrapper"},[e.createElementVNode("div",{class:"input",contenteditable:"true",onInput:a[2]||(a[2]=(...e)=>i.updatePassword&&i.updatePassword(...e)),placeholder:"密码"},null,32)]),e.createElementVNode("div",{class:"toggle-password",onClick:a[3]||(a[3]=(...e)=>i.togglePassword&&i.togglePassword(...e))},e.toDisplayString(s.showPassword?"👁️":"🔒"),1)]),e.createElementVNode("div",{class:"login-button",onClick:a[4]||(a[4]=(...e)=>i.login&&i.login(...e))},"登录")]),e.createElementVNode("div",{class:"register-link"},[e.createElementVNode("navigator",{url:"/pages/register/register"}," 没有账号，前往注册 ")])])}]]),T="/static/conversation-selected.png",S="/static/contact-selected.png",I="/static/me-selected.png";const C=p({data:()=>({pageNo:1,pageSize:10,activeTab:"conversation",conversations:[]}),onShow(){this.getConversationList()},methods:{formatTime(e){const t=new Date(e);return`${String(t.getHours()).padStart(2,"0")}:${String(t.getMinutes()).padStart(2,"0")}`},navigateTo(e){this.activeTab=e,"conversation"===e?this.$router.push("/pages/conversation/conversation"):"contact"===e?this.$router.push("/pages/contact/contact"):"my"===e&&this.$router.push("/pages/my/my")},async getConversationList(){const e=localStorage.getItem("login-token")||"";t("log","at pages/conversation/conversation.vue:86","loginToken:"+e);try{const o=await a({url:"/api/conversation/conversation-list",method:"GET",data:{pageNo:this.pageNo,pageSize:this.pageSize},header:{"login-token":e,ajax:!0}});t("log","at pages/conversation/conversation.vue:104","响应结果：",o),"0"===o.code?this.conversations=o.data.list:uni.showToast({title:o.message||"获取会话失败",icon:"none"})}catch(o){t("error","at pages/conversation/conversation.vue:116","获取会话失败:",o),uni.showToast({title:"获取会话失败，请重试",icon:"none"})}},navigateToChat(e){setTimeout((()=>{uni.navigateTo({url:`/pages/chat/chat?roomId=${e.roomId}&name=${e.name}&avatar=${e.avatar}`})}),5)}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"chat-page"},[e.createElementVNode("div",{class:"content"},[0===s.conversations.length?(e.openBlock(),e.createElementBlock("div",{key:0,class:"empty-state"},[e.createElementVNode("img",{src:"/static/empty.png",alt:"暂无会话",class:"empty-image"}),e.createElementVNode("div",{class:"empty-text"},"暂无会话")])):(e.openBlock(),e.createElementBlock("div",{key:1,class:"chat-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.conversations,((t,a)=>(e.openBlock(),e.createElementBlock("div",{key:a,class:"chat-item",onClick:e=>i.navigateToChat(t)},[e.createElementVNode("div",{class:"chat-avatar"},[e.createElementVNode("img",{src:t.avatar,alt:"头像",class:"avatar-img"},null,8,["src"])]),e.createElementVNode("div",{class:"chat-info"},[e.createElementVNode("div",{class:"chat-name"},e.toDisplayString(t.name),1),e.createElementVNode("div",{class:"chat-last-message"},e.toDisplayString(t.content),1)]),e.createElementVNode("div",{class:"chat-time"},e.toDisplayString(i.formatTime(t.lastSendTime)),1)],8,["onClick"])))),128))]))]),e.createElementVNode("div",{class:"tab-bar"},[e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"conversation"===s.activeTab}]),onClick:a[0]||(a[0]=e=>i.navigateTo("conversation"))},[e.createElementVNode("img",{src:T,alt:"消息",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"消息")],2),e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"contact"===s.activeTab}]),onClick:a[1]||(a[1]=e=>i.navigateTo("contact"))},[e.createElementVNode("img",{src:S,alt:"通讯录",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"通讯录")],2),e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"my"===s.activeTab}]),onClick:a[2]||(a[2]=e=>i.navigateTo("my"))},[e.createElementVNode("img",{src:I,alt:"我的",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"我的")],2)])])}],["__scopeId","data-v-334999e2"]]);
/*!
   * pinia v2.1.7
   * (c) 2023 Eduardo San Martin Morote
   * @license MIT
   */
let _;const B=e=>_=e,P=Symbol();function $(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var j,x;(x=j||(j={})).direct="direct",x.patchObject="patch object",x.patchFunction="patch function";const U="undefined"!=typeof window;function A(){const t=e.effectScope(!0),a=t.run((()=>e.ref({})));let o=[],n=[];const s=e.markRaw({install(e){B(s),s._a=e,e.provide(P,s),e.config.globalProperties.$pinia=s,n.forEach((e=>o.push(e))),n=[]},use(e){return this._a?o.push(e):n.push(e),this},_p:o,_a:null,_e:t,_s:new Map,state:a});return s}const M=()=>{};function O(t,a,o,n=M){t.push(a);const s=()=>{const e=t.indexOf(a);e>-1&&(t.splice(e,1),n())};return!o&&e.getCurrentScope()&&e.onScopeDispose(s),s}function D(e,...t){e.slice().forEach((e=>{e(...t)}))}const L=e=>e();function z(t,a){t instanceof Map&&a instanceof Map&&a.forEach(((e,a)=>t.set(a,e))),t instanceof Set&&a instanceof Set&&a.forEach(t.add,t);for(const o in a){if(!a.hasOwnProperty(o))continue;const n=a[o],s=t[o];$(s)&&$(n)&&t.hasOwnProperty(o)&&!e.isRef(n)&&!e.isReactive(n)?t[o]=z(s,n):t[o]=n}return t}const R=Symbol();const{assign:q}=Object;function F(t,a,o={},n,s,i){let c;const r=q({actions:{}},o),l={deep:!0};let d,u,m,g=[],p=[];const h=n.state.value[t];let v;function y(a){let o;d=u=!1,"function"==typeof a?(a(n.state.value[t]),o={type:j.patchFunction,storeId:t,events:m}):(z(n.state.value[t],a),o={type:j.patchObject,payload:a,storeId:t,events:m});const s=v=Symbol();e.nextTick().then((()=>{v===s&&(d=!0)})),u=!0,D(g,o,n.state.value[t])}i||h||(n.state.value[t]={}),e.ref({});const f=i?function(){const{state:e}=o,t=e?e():{};this.$patch((e=>{q(e,t)}))}:M;function N(e,a){return function(){B(n);const o=Array.from(arguments),s=[],i=[];function c(e){s.push(e)}function r(e){i.push(e)}let l;D(p,{args:o,name:e,store:k,after:c,onError:r});try{l=a.apply(this&&this.$id===t?this:k,o)}catch(d){throw D(i,d),d}return l instanceof Promise?l.then((e=>(D(s,e),e))).catch((e=>(D(i,e),Promise.reject(e)))):(D(s,l),l)}}const E={_p:n,$id:t,$onAction:O.bind(null,p),$patch:y,$reset:f,$subscribe(a,o={}){const s=O(g,a,o.detached,(()=>i())),i=c.run((()=>e.watch((()=>n.state.value[t]),(e=>{("sync"===o.flush?u:d)&&a({storeId:t,type:j.direct,events:m},e)}),q({},l,o))));return s},$dispose:function(){c.stop(),g=[],p=[],n._s.delete(t)}},k=e.reactive(E);n._s.set(t,k);const V=(n._a&&n._a.runWithContext||L)((()=>n._e.run((()=>(c=e.effectScope()).run(a)))));for(const T in V){const a=V[T];if(e.isRef(a)&&(b=a,!e.isRef(b)||!b.effect)||e.isReactive(a))i||(!h||$(w=a)&&w.hasOwnProperty(R)||(e.isRef(a)?a.value=h[T]:z(a,h[T])),n.state.value[t][T]=a);else if("function"==typeof a){const e=N(T,a);V[T]=e,r.actions[T]=a}}var w,b;return q(k,V),q(e.toRaw(k),V),Object.defineProperty(k,"$state",{get:()=>n.state.value[t],set:e=>{y((t=>{q(t,e)}))}}),n._p.forEach((e=>{q(k,c.run((()=>e({store:k,app:n._a,pinia:n,options:r}))))})),h&&i&&o.hydrate&&o.hydrate(k.$state,h),d=!0,u=!0,k}function W(t,a,o){let n,s;const i="function"==typeof a;function c(t,o){const c=e.hasInjectionContext();(t=t||(c?e.inject(P,null):null))&&B(t),(t=_)._s.has(n)||(i?F(n,a,s,t):function(t,a,o,n){const{state:s,actions:i,getters:c}=a,r=o.state.value[t];let l;l=F(t,(function(){r||(o.state.value[t]=s?s():{});const a=e.toRefs(o.state.value[t]);return q(a,i,Object.keys(c||{}).reduce(((a,n)=>(a[n]=e.markRaw(e.computed((()=>{B(o);const e=o._s.get(t);return c[n].call(e,e)}))),a)),{}))}),a,o,0,!0)}(n,s,t));return t._s.get(n)}return"string"==typeof t?(n=t,s=i?o:a):(s=t,n=t.id),c.$id=n,c}let G="Store";function H(e,t){return Array.isArray(t)?t.reduce(((t,a)=>(t[a]=function(){return e(this.$pinia)[a]},t)),{}):Object.keys(t).reduce(((a,o)=>(a[o]=function(){const a=e(this.$pinia),n=t[o];return"function"==typeof n?n.call(this,a):a[n]},a)),{})}const J=H;const Q=Object.freeze(Object.defineProperty({__proto__:null,get MutationType(){return j},PiniaVuePlugin:function(e){e.mixin({beforeCreate(){const e=this.$options;if(e.pinia){const t=e.pinia;if(!this._provided){const e={};Object.defineProperty(this,"_provided",{get:()=>e,set:t=>Object.assign(e,t)})}this._provided[P]=t,this.$pinia||(this.$pinia=t),t._a=this,U&&B(t)}else!this.$pinia&&e.parent&&e.parent.$pinia&&(this.$pinia=e.parent.$pinia)},destroyed(){delete this._pStores}})},acceptHMRUpdate:function(e,t){return()=>{}},createPinia:A,defineStore:W,getActivePinia:()=>e.hasInjectionContext()&&e.inject(P)||_,mapActions:function(e,t){return Array.isArray(t)?t.reduce(((t,a)=>(t[a]=function(...t){return e(this.$pinia)[a](...t)},t)),{}):Object.keys(t).reduce(((a,o)=>(a[o]=function(...a){return e(this.$pinia)[t[o]](...a)},a)),{})},mapGetters:J,mapState:H,mapStores:function(...e){return e.reduce(((e,t)=>(e[t.$id+G]=function(){return t(this.$pinia)},e)),{})},mapWritableState:function(e,t){return Array.isArray(t)?t.reduce(((t,a)=>(t[a]={get(){return e(this.$pinia)[a]},set(t){return e(this.$pinia)[a]=t}},t)),{}):Object.keys(t).reduce(((a,o)=>(a[o]={get(){return e(this.$pinia)[t[o]]},set(a){return e(this.$pinia)[t[o]]=a}},a)),{})},setActivePinia:B,setMapStoreSuffix:function(e){G=e},skipHydrate:function(e){return Object.defineProperty(e,R,{})},storeToRefs:function(t){{t=e.toRaw(t);const a={};for(const o in t){const n=t[o];(e.isRef(n)||e.isReactive(n))&&(a[o]=e.toRef(t,o))}return a}}},Symbol.toStringTag,{value:"Module"})),Z=W("chatStore",{id:"chat",state:()=>({roomId:0,pageSize:10,pageNo:1,messages:[],avatar:""}),actions:{setRoomId(e){this.roomId=e},setAvatar(e){this.avatar=e},async getMessageList(){try{const e=uni.getStorageSync("login-token");t("log","at store/chatStore.js:28","loginToken:",e);const o=await a({url:"/api/chat/message-list",method:"GET",data:{pageNo:this.pageNo,pageSize:this.pageSize,roomId:this.roomId},header:{"login-token":e,ajax:!0}});if(t("log","at store/chatStore.js:44","消息列表:",o),"0"===o.code){const e=uni.getStorageSync("loginUser").userId;this.messages=o.data.list.map((t=>{const a=t.senderUserId,o=t.roomId,n=a===e?"right":"left",s=t.id,i=t.body.content;return{...t,roomId:o,type:n,content:i,avatar:"https://wgq-im.oss-cn-nanjing.aliyuncs.com/DF957A521978414F505D705F8952C6B8.jpg",messageId:s}}))}else uni.showToast({title:o.message||"获取消息列表失败",icon:"none"})}catch(e){t("error","at store/chatStore.js:76","获取消息列表失败:",e),uni.showToast({title:"获取消息列表失败，请重试",icon:"none"})}},addOwnMessage(e){const t=uni.getStorageSync("loginUser").userId,a=e.senderUserId===t?"right":"left",o=e.roomId,n={messageId:e.messageId,roomId:o,type:a,content:e.body.content,avatar:e.avatar};this.messages.push(n)},addMessage(e){t("log","at store/chatStore.js:102","message",e);const a=uni.getStorageSync("loginUser").userId,o=e.roomId;if(t("log","at store/chatStore.js:106","roomId",o),t("log","at store/chatStore.js:107","this.roomId",this.roomId),t("log","at store/chatStore.js:108","roomId !== this.roomId",o!==this.roomId),o!==Number(this.roomId))return;const n=e.senderUserId;if(n===a)return;const s=n===a?"right":"left",i=e.content,c=e.id,r={type:s,content:i,avatar:this.avatar,roomId:o,messageId:c};this.messages.push(r),t("log","at store/chatStore.js:130","this.chats",this.messages)}},getters:{currentChats:e=>e.chats}});const K=p({props:{roomId:{type:Number,required:!0,default:0},avatar:{type:String,required:!0}},setup(a){const o=Z(),n=e.ref(""),s=e.ref([]),i=Number(a.roomId),c=a.avatar;t("log","at pages/chat/chat.vue:55","roomId",i),t("log","at pages/chat/chat.vue:56","avatar",c),o.setRoomId(i),o.setAvatar(c),e.watch((()=>o.messages),(t=>{s.value=t,e.nextTick((()=>{r()}))}),{immediate:!0});const r=()=>{const e=document.querySelector(".chat-content");e&&(e.scrollTop=e.scrollHeight)};return e.onMounted((async()=>{await o.getMessageList(),e.nextTick((()=>{r()}))})),e.onUnmounted((()=>{})),{chatStore:o,content:n,scrollToBottom:r}},methods:{async sendMessage(){if(t("log","at pages/chat/chat.vue:105","Enter key pressed, content: ",this.content),""===this.content.trim())return void uni.showToast({title:"请输入内容",icon:"none"});const e={messageType:1,roomId:40,body:{content:this.content}};try{const o=localStorage.getItem("login-token")||"";t("log","at pages/chat/chat.vue:124","loginToken:"+o);const n=await a({url:"/api/chat/sendMessage",method:"POST",data:e,header:{"login-token":o,ajax:!0}});if("0"===n.code){this.content="";Z().addOwnMessage(n.data),this.scrollToBottom()}else uni.showToast({title:n.message||"发送消息失败",icon:"none"})}catch(o){t("error","at pages/chat/chat.vue:150","发送消息失败:",o),uni.showToast({title:"发送消息失败，请重试",icon:"none"})}}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"chat-page"},[e.createElementVNode("div",{class:"chat-content",ref:"messageContainer"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(n.chatStore.messages,((t,a)=>(e.openBlock(),e.createElementBlock("div",{key:a,class:e.normalizeClass(["message-item","right"===t.type?"right":"left"])},["left"===t.type?(e.openBlock(),e.createElementBlock("div",{key:0,class:"avatar"},[e.createElementVNode("img",{src:t.avatar,alt:"头像"},null,8,["src"])])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:"message-bubble"},e.toDisplayString(t.content),1),"right"===t.type?(e.openBlock(),e.createElementBlock("div",{key:1,class:"avatar"},[e.createElementVNode("img",{src:t.avatar,alt:"头像"},null,8,["src"])])):e.createCommentVNode("",!0)],2)))),128))],512),e.createElementVNode("div",{class:"chat-input-bar"},[e.createElementVNode("div",{class:"input-actions"},[e.createElementVNode("img",{src:"/static/microphone-icon.png",alt:"语音"})]),e.withDirectives(e.createElementVNode("input",{type:"text","onUpdate:modelValue":a[0]||(a[0]=e=>n.content=e),class:"input-box",placeholder:"发送消息...",onKeydown:a[1]||(a[1]=e.withKeys(((...e)=>i.sendMessage&&i.sendMessage(...e)),["enter"]))},null,544),[[e.vModelText,n.content]]),e.createElementVNode("div",{class:"input-actions"},[e.createElementVNode("img",{src:"/static/biaoqing.png",alt:"表情"}),e.createElementVNode("img",{src:"/static/send-more.png",alt:"更多"})])])])}],["__scopeId","data-v-b2185464"]]);const X=p({data:()=>({pageNo:1,pageSize:10,activeTab:"contact",groupContacts:[]}),onShow(){this.contactList()},methods:{async contactList(){const e=uni.getStorageSync("login-token");t("log","at pages/contact/contact.vue:136","loginToken:"+e);try{const o=await a({url:"/api/contact/contact-list",method:"GET",data:{pageNo:this.pageNo,pageSize:this.pageSize},header:{"login-token":e,ajax:!0}});if(t("log","at pages/contact/contact.vue:154","联系人列表：",o),"0"===o.code){const e=o.data.list.map((e=>({nationality:e.userVO.nationality,flagUrl:e.userVO.flagUrl,roomId:e.roomId,userId:e.userVO.userId,userName:e.userVO.userName,nickName:e.userVO.nickName,avatar:e.userVO.avatar})));this.groupContacts=[{letter:"A",contacts:e}],t("log","at pages/contact/contact.vue:179","groupContacts",this.groupContacts)}else uni.showToast({title:o.message||"获取联系人失败",icon:"none"})}catch(o){t("error","at pages/contact/contact.vue:187","获取联系人失败:",o),uni.showToast({title:"获取联系人失败，请重试",icon:"none"})}},navigateToDetail(e){this.$router.push({path:"/pages/contact/contact-detail",query:{roomId:e.roomId,userId:e.userId,userName:e.userName,nickName:e.nickName,avatar:e.avatar}})},navigateTo(e){this.activeTab=e,"conversation"===e?this.$router.push("/pages/conversation/conversation"):"contact"===e?this.$router.push("/pages/contact/contact"):"my"===e?this.$router.push("/pages/my/my"):"contact-detail"===e&&this.$router.push({path:"/pages/contact/contact-detail",query:{userId:1}})},verifyMessage(){uni.showToast({title:"此功能正在开发中...",icon:"none"})},blackList(){uni.showToast({title:"此功能正在开发中...",icon:"none"})},myQunList(){uni.showToast({title:"此功能正在开发中...",icon:"none"})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"container"},[e.createElementVNode("div",{class:"contact-list"},[e.createElementVNode("div",{class:"contact-item"},[e.createElementVNode("div",{class:"contact-icon"},[e.createElementVNode("img",{src:"/static/yanzheng.png",alt:"Verify",class:"icon"})]),e.createElementVNode("div",{class:"contact-info"},[e.createElementVNode("div",{class:"contact-name",onClick:a[0]||(a[0]=(...e)=>i.verifyMessage&&i.verifyMessage(...e))},"验证消息")]),e.createElementVNode("div",{class:"arrow"},">")]),e.createElementVNode("div",{class:"contact-item"},[e.createElementVNode("div",{class:"contact-icon"},[e.createElementVNode("img",{src:"/static/black.png",alt:"Blacklist",class:"icon"})]),e.createElementVNode("div",{class:"contact-info"},[e.createElementVNode("div",{class:"contact-name",onClick:a[1]||(a[1]=(...e)=>i.blackList&&i.blackList(...e))},"黑名单")]),e.createElementVNode("div",{class:"arrow"},">")]),e.createElementVNode("div",{class:"contact-item"},[e.createElementVNode("div",{class:"contact-icon"},[e.createElementVNode("img",{src:"/static/group.png",alt:"Group Chat",class:"icon"})]),e.createElementVNode("div",{class:"contact-info"},[e.createElementVNode("div",{class:"contact-name",onClick:a[2]||(a[2]=(...e)=>i.myQunList&&i.myQunList(...e))},"我的群聊")]),e.createElementVNode("div",{class:"arrow"},">")])]),e.createElementVNode("div",{class:"contact-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(s.groupContacts,((t,a)=>(e.openBlock(),e.createElementBlock("div",{key:a},[e.createElementVNode("div",{class:"group-header"},e.toDisplayString(t.letter),1),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(t.contacts,((t,a)=>(e.openBlock(),e.createElementBlock("div",{key:a,class:"contact-item",onClick:e=>i.navigateToDetail(t)},[e.createElementVNode("div",{class:"avatar-container"},[e.createElementVNode("img",{class:"avatar",src:t.avatar,alt:"Avatar"},null,8,["src"])]),e.createElementVNode("div",{class:"contact-info"},[e.createElementVNode("div",{class:"contact-name"},e.toDisplayString(t.userName),1)])],8,["onClick"])))),128))])))),128))]),e.createElementVNode("div",{class:"tab-bar"},[e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"conversation"===s.activeTab}]),onClick:a[3]||(a[3]=e=>i.navigateTo("conversation"))},[e.createElementVNode("img",{src:T,alt:"消息",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"消息")],2),e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"contact"===s.activeTab}]),onClick:a[4]||(a[4]=e=>i.navigateTo("contact"))},[e.createElementVNode("img",{src:S,alt:"通讯录",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"通讯录")],2),e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"my"===s.activeTab}]),onClick:a[5]||(a[5]=e=>i.navigateTo("my"))},[e.createElementVNode("img",{src:I,alt:"我的",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"我的")],2)])])}],["__scopeId","data-v-5a85667b"]]);const Y=p({data:()=>({roomId:0,userId:0,userName:"",nickName:"",avatar:"",isBlacklisted:!1,details:[{label:"备注名",value:"未设置"},{label:"生日",value:"未设置"},{label:"手机",value:"未设置"},{label:"邮箱",value:"未设置"},{label:"个性签名",value:"未设置"}]}),mounted(){const{roomId:e,userId:t,userName:a,nickName:o,avatar:n}=this.$route.query;this.roomId=e,this.userId=t,this.userName=a,this.nickName=o,this.avatar=n},methods:{toggleBlacklist(e){uni.showToast({title:"此功能正在开发中...",icon:"none"})},navigateToChat(){const{roomId:e,userId:a,userName:o,nickName:n,avatar:s}=this.$route.query;t("log","at pages/contact/contact-detail.vue:111","Current page query params:",{roomId:e,name:name,avatar:s}),setTimeout((()=>{uni.navigateTo({url:`/pages/chat/chat?roomId=${Number(e)}&name=${n}&avatar=${s}`})}),3)},startChat(){uni.showToast({title:"进入聊天",icon:"none"})},deleteFriend(){uni.showModal({title:"提示",content:"确定删除好友吗？",success:e=>{e.confirm&&uni.showToast({title:"好友已删除",icon:"none"})}})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"container"},[e.createElementVNode("div",{class:"profile"},[e.createElementVNode("img",{class:"avatar",src:s.avatar,alt:"Avatar"},null,8,["src"]),e.createElementVNode("div",{class:"info"},[e.createElementVNode("div",{class:"name"},e.toDisplayString(s.nickName),1),e.createElementVNode("div",{class:"account"},"账号: "+e.toDisplayString(s.userName),1)])]),e.createElementVNode("div",{class:"actions"},[e.createElementVNode("button",{class:"chat-btn",onClick:a[0]||(a[0]=(...e)=>i.navigateToChat&&i.navigateToChat(...e))},"发消息"),e.createElementVNode("button",{class:"delete-btn",onClick:a[1]||(a[1]=(...e)=>i.deleteFriend&&i.deleteFriend(...e))},"删除好友")])])}],["__scopeId","data-v-6cddf9f2"]]);const ee=p({data:()=>({userName:"",nickName:"",activeTab:"my"}),onLoad(){const e=uni.getStorageSync("loginUser");this.userName=e.userName,this.nickName=e.nickName},methods:{navigateTo(e){this.activeTab=e,"conversation"===e?this.$router.push("/pages/conversation/conversation"):"contact"===e?this.$router.push("/pages/contact/contact"):"my"===e?this.$router.push("/pages/my/my"):"settings"===e&&this.$router.push("/pages/my/settings")}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"profile-container"},[e.createElementVNode("div",{class:"profile-header"},[e.createElementVNode("div",{class:"profile-img"},[e.createElementVNode("img",{src:"https://wgq-im.oss-cn-nanjing.aliyuncs.com/DF957A521978414F505D705F8952C6B8.jpg",alt:"User Avatar"})]),e.createElementVNode("div",{class:"user-info"},[e.createElementVNode("div",{class:"username"},e.toDisplayString(s.nickName),1),e.createElementVNode("div",{class:"account"},"账号:"+e.toDisplayString(s.userName),1)])]),e.createElementVNode("div",{class:"action-list"},[e.createElementVNode("div",{class:"action-item"},[e.createElementVNode("div",{class:"action-icon"},[e.createElementVNode("img",{src:"/static/shezhi.png",alt:"Settings"}),e.createElementVNode("div",{class:"action-text"},"设置")]),e.createElementVNode("div",{class:"arrow",onClick:a[0]||(a[0]=e=>i.navigateTo("settings"))},">")])]),e.createElementVNode("div",{class:"tab-bar"},[e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"conversation"===s.activeTab}]),onClick:a[1]||(a[1]=e=>i.navigateTo("conversation"))},[e.createElementVNode("img",{src:T,alt:"消息",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"消息")],2),e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"contact"===s.activeTab}]),onClick:a[2]||(a[2]=e=>i.navigateTo("contact"))},[e.createElementVNode("img",{src:S,alt:"通讯录",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"通讯录")],2),e.createElementVNode("div",{class:e.normalizeClass(["tab-item",{active:"my"===s.activeTab}]),onClick:a[3]||(a[3]=e=>i.navigateTo("my"))},[e.createElementVNode("img",{src:I,alt:"我的",class:"tab-icon"}),e.createElementVNode("div",{class:"tab-text"},"我的")],2)])])}],["__scopeId","data-v-5fedba4e"]]);const te=p({data:()=>({settings:{listenMode:!0,readUnread:!0}}),methods:{toggleListenMode(e){this.settings.listenMode=e.target.checked,t("log","at pages/my/settings.vue:56","听筒模式切换为:",this.settings.listenMode?"开":"关")},toggleReadUnread(e){this.settings.readUnread=e.target.checked,t("log","at pages/my/settings.vue:61","消息已读未读功能切换为:",this.settings.readUnread?"开":"关")},goToPage(e){t("log","at pages/my/settings.vue:65",`跳转到 ${e} 页面`),uni.navigateTo({url:`/pages/${e}/${e}`})},logout(){uni.showModal({title:"确认退出登录",content:"退出登录后需要重新登录，确定要退出吗？",success:e=>{e.confirm?(t("log","at pages/my/settings.vue:77","用户确认退出登录"),uni.clearStorageSync(),uni.reLaunch({url:"/pages/login/login"})):t("log","at pages/my/settings.vue:84","用户取消退出")}})}}},[["render",function(t,a,o,n,s,i){return e.openBlock(),e.createElementBlock("div",{class:"settings-page"},[e.createElementVNode("div",{class:"logout-btn",onClick:a[0]||(a[0]=(...e)=>i.logout&&i.logout(...e))},[e.createElementVNode("span",null,"退出登录")])])}]]);__definePage("pages/login/login",h),__definePage("pages/register/register",V),__definePage("pages/register/register-1",w),__definePage("pages/login/login-1",b),__definePage("pages/conversation/conversation",C),__definePage("pages/chat/chat",K),__definePage("pages/contact/contact",X),__definePage("pages/contact/contact-detail",Y),__definePage("pages/my/my",ee),__definePage("pages/my/settings",te);const ae=4,oe=1,ne={data:()=>({isExit:!1,reconnecting:!1}),methods:{init(){this.isExit=!1;try{this.initWebsocket()}catch(e){t("log","at App.vue:22",e),this.exit()}},initWebsocket(){const e=uni.getStorageSync("login-token");d||(d=!0,uni.onSocketOpen((e=>{t("log","at common/websocket.js:18","WebSocket连接已打开"),r=!0;let a={type:1,token:n};t("log","at common/websocket.js:25","authorizeInfo===========",a),uni.sendSocketMessage({data:JSON.stringify(a)})})),uni.onSocketMessage((e=>{let a=JSON.parse(e.data);1==a.type?(g.start(),c&&c(),t("log","at common/websocket.js:36","WebSocket授权成功")):3==a.type?g.reset():(t("log","at common/websocket.js:42","接收到消息",a),s&&s(a.type,a.data))})),uni.onSocketClose((e=>{t("log","at common/websocket.js:48","WebSocket连接关闭"),r=!1,i&&i(e)})),uni.onSocketError((e=>{t("log","at common/websocket.js:54",e),r=!1,i&&i({code:1006})}))),m(k.WS_URL,e),c=()=>{this.reconnecting&&(this.reconnecting=!1,uni.showToast({title:"已重新连接",icon:"none"}))},function(e){s=e}(((e,t)=>{ae===e&&this.handlerNewMessage(t)})),function(e){i=e}((e=>{t("log","at App.vue:60","ws断开",e),this.reconnectWebsocket()}))},reconnectWebsocket(){if(!this.isExit){this.reconnecting=!0;try{const e=uni.getStorageSync("login-token");((e,a)=>{if(t("log","at common/websocket.js:84","尝试重新连接"),r)return;let o=(new Date).getTime()-u.getTime(),n=o<1e4?1e4-o:0;l&&clearTimeout(l),l=setTimeout((function(){m(e,a)}),n)})(k.WS_URL,e)}catch(e){setTimeout((()=>{this.reconnectWebsocket()}),5e3)}}},loadStore(){return this.chatStore.loadChat()},unloadStore(){this.chatStore.clear(),this.userStore.clear()},exit(){var e;t("log","at App.vue:105","exit"),this.isExit=!0,e=3099,r&&uni.closeSocket({code:e,complete:e=>{t("log","at common/websocket.js:105","关闭websocket连接"),r=!1},fail:e=>{t("log","at common/websocket.js:108","关闭websocket连接失败",e)}}),uni.removeStorageSync("loginUser"),uni.removeStorageSync("login-token"),uni.reLaunch({url:"/pages/login/login"}),this.unloadStore()},handlerNewMessage(e){t("log","at App.vue:116","this.chatStore",this.chatStore),oe!==e.type?t("log","at App.vue:122","其他类型消息赞不处理",e.type):this.chatStore.addMessage(e)}},onLaunch(){try{this.$mountStore();const e=uni.getStorageSync("login-token");uni.getStorageSync("loginUser")&&e&&(this.init(),uni.navigateTo({url:"/pages/conversation/conversation"}))}catch(e){t("error","at App.vue:149","获取登录信息失败",e)}}},se=W("userStore",{state:()=>({userInfo:{}}),actions:{setUserInfo(e){this.userInfo=e},clear(){this.userInfo={}},loadUser(e){return new Promise(((e,a)=>{http({url:"/user/self",method:"GET"}).then((a=>{t("log","at store/userStore.js:22",a),this.setUserInfo(a),e()})).catch((e=>{a(e)}))}))}}});const{app:ie,Vuex:ce,Pinia:re}=function(){const t=e.createVueApp(ne);return t.use(A()),t.config.globalProperties.$mountStore=()=>{t.config.globalProperties.chatStore=Z(),t.config.globalProperties.userStore=se()},{app:t,pinia:Q}}();uni.Vuex=ce,uni.Pinia=re,ie.provide("__globalStyles",__uniConfig.styles),ie._component.mpType="app",ie._component.render=()=>{},ie.mount("#app")}(Vue);
